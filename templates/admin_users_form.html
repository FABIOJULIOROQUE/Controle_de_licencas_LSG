{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>{% if usuario %}Editar Usuário{% else %}Novo Usuário{% endif %}</h2>

    <form method="POST">
        <div class="form-group">
            <label for="nome">Nome</label>
            <input type="text" class="form-control" id="nome" name="nome" 
                   value="{{ usuario['nome'] if usuario else '' }}" required>
        </div>

        <div class="form-group">
            <label for="email">E-mail</label>
            <input type="email" class="form-control" id="email" name="email"
                   value="{{ usuario['email'] if usuario else '' }}" required>
        </div>

        <div class="form-group">
            <label for="senha">Senha</label>
            <input type="password" class="form-control" id="senha" name="senha"
                   placeholder="Deixe em branco para não alterar">
        </div>

        <div class="form-group">
            <label for="tipo">Tipo</label>
            <select class="form-control" id="tipo" name="tipo" required>
                <option value="user" {% if usuario and usuario['tipo']=='user' %}selected{% endif %}>Usuário</option>
                <option value="admin" {% if usuario and usuario['tipo']=='admin' %}selected{% endif %}>Admin</option>
            </select>
        </div>

        <!-- ========================= -->
        <!-- Representante -->
        <!-- ========================= -->
        <div class="form-group">
            <label for="representante">Representante</label>
            <select class="form-control" id="representante" name="representante"
                {% if session.get('user_tipo') != "admin" %} required {% endif %}>
                <option value="">-- Selecione --</option>
                {% if session.get('user_tipo') == "admin" %}
                    <option value="Todos" {% if usuario and usuario['representante']=="Todos" %}selected{% endif %}>-- Todos --</option>
                {% endif %}
                {% for rep in representantes %}
                    <option value="{{ rep }}" {% if usuario and usuario['representante']==rep %}selected{% endif %}>{{ rep }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- ========================= -->
        <!-- Estado -->
        <!-- ========================= -->
        <div class="form-group">
            <label for="estado">Estado (Opcional)</label>
            <select class="form-control" id="estado" name="estado">
                <option value="">-- Selecione --</option>
                {% if session.get('user_tipo') == "admin" %}
                    <option value="Todos" {% if usuario and usuario['estado']=="Todos" %}selected{% endif %}>-- Todos --</option>
                {% endif %}
                {% for est in estados %}
                    <option value="{{ est }}" {% if usuario and usuario['estado']==est %}selected{% endif %}>{{ est }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- ========================= -->
        <!-- Cidade -->
        <!-- ========================= -->
        <div class="form-group">
            <label for="cidade">Cidade (Opcional)</label>
            <select class="form-control" id="cidade" name="cidade">
                <option value="">-- Selecione --</option>
                {% if session.get('user_tipo') == "admin" %}
                    <option value="Todos" {% if usuario and usuario['cidade']=="Todos" %}selected{% endif %}>-- Todas --</option>
                {% endif %}
                {% for cid in cidades %}
                    <option value="{{ cid }}" {% if usuario and usuario['cidade']==cid %}selected{% endif %}>{{ cid }}</option>
                {% endfor %}
            </select>
        </div>

        <br>
        <button type="submit" class="btn btn-primary">Salvar</button>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">Voltar</a>
    </form>
</div>
{% endblock %}
